/*
 * jQuery.zip2addr
 *
 * Copyright 2010, Kotaro Kokubo a.k.a kotarok kotaro@nodot.jp
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Orign:
 * https://github.com/kotarok/jQuery.zip2addr
 * Fork:
 * https://github.com/chaika-design/jQuery.zip2addr
 */
$.fn.zip2addr=function(e){var d;d="object"!=typeof e?{addr:e}:jQuery.extend({},jQuery.fn.zip2addr.defaults,e);var m=location.protocol+"//www.google.com/transliterate?langpair=ja-Hira|ja&jsonp=?",f=$.fn.zip2addr.cache,n=function(c){var b=jQuery.Deferred();jQuery.ajax({url:m,data:{text:c},dataType:"json",type:"get",success:b.resolve,error:b.reject});return b.promise()},k=function(){if(d.pref){var c=$(d.addr),b=$(d.pref);return function(a){a=a.split(",");var h=c.val();a?RegExp(a[1]).test(h)||(b.val(a[0]),c.val(a[1])):RegExp(a[1]).test(h)||b.add(d.addr).val("")}}return function(a){a=a.replace(",","");var b=$(d.addr||d),c=b.val();a?RegExp(a).test(c)||b.val(a):RegExp(a).test(c)||b.val("")}}(),g=function(){var c=/[\uFF01-\uFF5E]/g,b=function(a){return String.fromCharCode(a.charCodeAt()-65248)};return function(a){return a.replace(c,b)}}(),l=function(c){var b=g(c).replace(/\D/g,"");7==b.length&&(void 0==f[b]?n(b.replace(/(\d\d\d)(\d\d\d\d)/,"$1-$2")).done(function(a){RegExp("(\u6771\u4eac\u90fd|\u9053|\u5e9c|\u770c)").test(a[0][1][0])&&(a=a[0][1][0].replace(RegExp("(.*?(\u6771\u4eac\u90fd|\u9053|\u5e9c|\u770c))(.+)"),function(a,b,c,d){return[b,d]}),f[b]=a,k(a))}).fail(function(a,b,c){console.log("Ajax Error",a,b,c)}):k(f[b]))};this.each(function(){var c=$(this);if(d.zip2){var b=$(d.zip2);c.add(b).on("keyup.zip2addr change.zip2addr",function(){l(c.val()+""+b.val())}).on("blur.zip2addr",function(){var a=$(this),b=a.val();7===b.length&&a.val(g(b))})}else c.on("keyup.zip2addr change.zip2addr",function(){l(c.val())}).on("blur.zip2addr",function(){var a=c.val();7===a.length&&c.val(g(a).replace(/\D/g,"").replace(/(\d\d\d)(\d\d\d\d)/,"$1-$2"))})});return this};$.fn.zip2addr.defaults={zip2:null,addr:null,pref:null};$.fn.zip2addr.cache={};
